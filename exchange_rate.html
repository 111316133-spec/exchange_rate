<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£åŒ¯ç‡å³æ™‚ç›£æ§ç³»çµ± </title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --up: #e74c3c;
            --down: #27ae60;
        }

        body {
            font-family: 'Segoe UI', Microsoft JhengHei, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1, h2 { text-align: center; color: var(--primary); }

        /* å¡ç‰‡å€åŸŸ */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.2s;
        }

        .card:hover { transform: translateY(-3px); }
        .currency-name { font-weight: bold; color: #777; font-size: 0.9em; }
        .rate-value { font-size: 1.4em; font-weight: bold; margin: 10px 0; }
        .trend { font-size: 0.8em; }
        .up { color: var(--up); }
        .down { color: var(--down); }

        /* è½‰æ›å™¨å€åŸŸ */
        .converter-section, .history-section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .converter-box {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
        }

        input, select, button {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        /* äº¤æ›æŒ‰éˆ•æ¨£å¼ */
        .swap-btn {
            background-color: #f39c12;
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .swap-btn:hover { background-color: #e67e22; }

        .action-btn {
            background-color: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
        }
        .action-btn:hover { background-color: #2980b9; }
        
        .result-display {
            margin-top: 15px;
            font-size: 1.2em;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
        }

        .timestamp {
            font-size: 0.8em;
            color: #999;
            text-align: center;
            margin-top: 5px;
        }

        /* åœ–è¡¨å€åŸŸ */
        .chart-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>é™³åª½åª½-å°ç£åŒ¯ç‡å³æ™‚ç›£æ§ä¸­å¿ƒ</h1>
    
    <p style="text-align: center; color: #666; font-size: 0.9em;">è³‡æ–™æ›´æ–°é »ç‡ï¼šæ¯ç§’ (æ¨¡æ“¬æ•¸æ“š)</p>

    <div class="dashboard" id="rateDashboard">
        </div>

    <div class="converter-section">
        <h2>ğŸ’° å³æ™‚åŒ¯ç‡è©¦ç®—</h2>
        <div class="converter-box">
            <input type="number" id="amount" value="1000" min="0" oninput="calculate()">
            
            <select id="fromCurrency" onchange="calculate()">
                </select>
            
            <button class="swap-btn" onclick="swapCurrencies()" title="äº¤æ›å¹£åˆ¥">â‡„</button>
            
            <select id="toCurrency" onchange="calculate()">
                </select>
        </div>
        <div class="result-display" id="conversionResult">æ­£åœ¨è¼‰å…¥åŒ¯ç‡...</div>
        <div class="timestamp" id="lastUpdate">æ›´æ–°æ™‚é–“ï¼š--:--:--</div>
    </div>

    <div class="history-section">
        <h2>ğŸ“ˆ åŒ¯ç‡èµ°å‹¢èˆ‡æ­·å²æŸ¥è©¢</h2>
        
        <div class="chart-controls">
            <button class="action-btn" onclick="updateChartRange(7)">è¿‘ 7 å¤©</button>
            <button class="action-btn" onclick="updateChartRange(30)">è¿‘ 1 å€‹æœˆ</button>
            <span>|</span>
            <input type="date" id="historyDate">
            <button class="action-btn" onclick="queryHistoryDate()">æŸ¥è©¢ç‰¹å®šæ—¥</button>
        </div>

        <div style="text-align: center; margin-bottom:10px;">
            ç•¶å‰é¡¯ç¤ºï¼š<span id="chartCurrencyTitle" style="font-weight:bold; color:var(--accent);">USD (ç¾é‡‘)</span> å° TWD èµ°å‹¢
            <select id="chartCurrencySelect" onchange="changeChartCurrency(this.value)" style="margin-left:10px; padding:5px;">
                </select>
        </div>

        <div class="chart-container">
            <canvas id="rateChart"></canvas>
        </div>
    </div>
</div>

<script>
    // --- 1. è¨­å®šèˆ‡åˆå§‹åŒ–è³‡æ–™ (ç„¡ JPY) ---
    const currencies = {
        'USD': { name: 'ç¾é‡‘', baseRate: 31.5 },
        'EUR': { name: 'æ­å…ƒ', baseRate: 34.2 },
        'CNY': { name: 'äººæ°‘å¹£', baseRate: 4.35 },
        'KRW': { name: 'éŸ“å…ƒ', baseRate: 0.024 },
        'AUD': { name: 'æ¾³å¹£', baseRate: 20.8 }
    };

    // å„²å­˜ç•¶å‰å³æ™‚åŒ¯ç‡ (ç›¸å°æ–¼ TWD)
    let currentRates = {};
    Object.keys(currencies).forEach(key => {
        currentRates[key] = currencies[key].baseRate;
    });
    // TWD è‡ªèº«åŒ¯ç‡æ°¸é æ˜¯ 1
    currentRates['TWD'] = 1;

    // --- 2. æ¨¡æ“¬å¾Œç«¯ï¼šæ¯ç§’æ›´æ–°åŒ¯ç‡é‚è¼¯ ---
    function simulateLiveRates() {
        const now = new Date();
        const timeString = now.toLocaleTimeString();

        Object.keys(currencies).forEach(code => {
            const volatility = currencies[code].baseRate * 0.002; 
            const change = (Math.random() - 0.5) * volatility;
            let newRate = currentRates[code] + change;
            
            const trendClass = newRate > currentRates[code] ? 'up' : 'down';
            const arrow = newRate > currentRates[code] ? 'â–²' : 'â–¼';
            
            currentRates[code] = newRate;

            // æ›´æ–° Dashboard
            const card = document.getElementById(`card-${code}`);
            if(card) {
                card.querySelector('.rate-value').innerText = newRate.toFixed(4);
                card.querySelector('.rate-value').className = `rate-value ${trendClass}`;
                card.querySelector('.trend').innerHTML = `<span class="${trendClass}">${arrow} 1 ${code} â‰ˆ ${newRate.toFixed(4)} TWD</span>`;
            }
        });

        document.getElementById('lastUpdate').innerText = `æœ€å¾Œæ›´æ–°æ™‚é–“ï¼š${timeString}`;
        calculate(false); // æ›´æ–°è¨ˆç®—çµæœ
    }

    // --- 3. UI åˆå§‹åŒ– ---
    function initDashboard() {
        const container = document.getElementById('rateDashboard');
        const fromSelect = document.getElementById('fromCurrency');
        const toSelect = document.getElementById('toCurrency');
        const chartSelect = document.getElementById('chartCurrencySelect');

        container.innerHTML = '';
        fromSelect.innerHTML = '';
        toSelect.innerHTML = '';
        chartSelect.innerHTML = '';

        // 1. ç”¢ç”Ÿä¸‹æ‹‰é¸å–®é¸é … HTML
        let optionsHtml = '';
        // å…ˆåŠ  TWD
        optionsHtml += `<option value="TWD">TWD (æ–°å°å¹£)</option>`;
        // å†åŠ å…¶ä»–å¹£åˆ¥
        Object.keys(currencies).forEach(code => {
            // å»ºç«‹å¡ç‰‡
            const card = document.createElement('div');
            card.className = 'card';
            card.id = `card-${code}`;
            card.innerHTML = `
                <div class="currency-name">${currencies[code].name} (${code})</div>
                <div class="rate-value">${currencies[code].baseRate}</div>
                <div class="trend">-</div>
            `;
            container.appendChild(card);

            // ç´¯ç©é¸é …å­—ä¸²
            optionsHtml += `<option value="${code}">${code} (${currencies[code].name})</option>`;
        });

        // 2. å¡«å……æ‰€æœ‰ä¸‹æ‹‰é¸å–®
        fromSelect.innerHTML = optionsHtml;
        toSelect.innerHTML = optionsHtml;
        // åœ–è¡¨é¸å–®ä¸éœ€è¦ TWD (å› ç‚ºæ˜¯ å°TWD èµ°å‹¢)
        let chartOptions = '';
        Object.keys(currencies).forEach(code => {
            chartOptions += `<option value="${code}">${code} (${currencies[code].name})</option>`;
        });
        chartSelect.innerHTML = chartOptions;

        // 3. è¨­å®šé è¨­å€¼ (TWD æ› USD)
        fromSelect.value = 'TWD';
        toSelect.value = 'USD';
    }

    // --- 4. åŒ¯ç‡è¨ˆç®—æ©Ÿé‚è¼¯ (é›™å‘é€šç”¨ç‰ˆ) ---
    function calculate() {
        const amount = parseFloat(document.getElementById('amount').value);
        if (isNaN(amount)) return; // é¿å…ç©ºå€¼éŒ¯èª¤

        const from = document.getElementById('fromCurrency').value;
        const to = document.getElementById('toCurrency').value;
        
        // æ ¸å¿ƒå…¬å¼ï¼š (é‡‘é¡ * ä¾†æºå¹£åŒ¯ç‡) / ç›®æ¨™å¹£åŒ¯ç‡
        // ä¾‹å¦‚ï¼š100 USD (30) æ› TWD (1) => 100 * 30 / 1 = 3000
        // ä¾‹å¦‚ï¼š3000 TWD (1) æ› USD (30) => 3000 * 1 / 30 = 100
        
        const rateFrom = currentRates[from];
        const rateTo = currentRates[to];
        
        const result = (amount * rateFrom) / rateTo;
        const exchangeRate = rateFrom / rateTo; // å…©è€…ä¹‹é–“çš„äº¤å‰åŒ¯ç‡

        const display = document.getElementById('conversionResult');
        display.innerHTML = `
            ${amount} ${from} = <span style="color:#e74c3c">${result.toFixed(2)}</span> ${to}<br>
            <span style="font-size:0.6em; color:#666">
                å³æ™‚åŒ¯ç‡: 1 ${from} â‰ˆ ${exchangeRate.toFixed(4)} ${to}
            </span>
        `;
    }

    // äº¤æ›å¹£åˆ¥åŠŸèƒ½
    function swapCurrencies() {
        const fromSelect = document.getElementById('fromCurrency');
        const toSelect = document.getElementById('toCurrency');
        
        const temp = fromSelect.value;
        fromSelect.value = toSelect.value;
        toSelect.value = temp;
        
        calculate(); // ç«‹å³é‡æ–°è¨ˆç®—
    }

    // --- 5. åœ–è¡¨é‚è¼¯ (Chart.js) ---
    let myChart = null;
    let currentChartCurrency = 'USD';

    function initChart() {
        const ctx = document.getElementById('rateChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [{
                    label: `åŒ¯ç‡èµ°å‹¢`,
                    data: [],
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false } },
                    y: { beginAtZero: false }
                }
            }
        });
        updateChartRange(7);
    }

    function generateHistoryData(days) {
        const labels = [];
        const data = [];
        const base = currencies[currentChartCurrency].baseRate;
        for (let i = days; i >= 0; i--) {
            const d = new Date();
            d.setDate(d.getDate() - i);
            labels.push(d.toLocaleDateString());
            const randomVar = (Math.random() - 0.5) * (base * 0.05); 
            data.push(base + randomVar);
        }
        return { labels, data };
    }

    function updateChartRange(days) {
        const history = generateHistoryData(days);
        myChart.data.labels = history.labels;
        myChart.data.datasets[0].data = history.data;
        myChart.data.datasets[0].label = `${currentChartCurrency}/TWD`;
        myChart.update();
    }

    function changeChartCurrency(currency) {
        currentChartCurrency = currency;
        document.getElementById('chartCurrencyTitle').innerText = `${currency} (${currencies[currency].name})`;
        updateChartRange(7);
    }

    function queryHistoryDate() {
        const dateInput = document.getElementById('historyDate').value;
        if (!dateInput) { alert("è«‹é¸æ“‡æ—¥æœŸ"); return; }
        const base = currencies[currentChartCurrency].baseRate;
        const randomRate = base + (Math.random() - 0.5) * (base * 0.03);
        alert(`${dateInput} ç•¶æ—¥ \n${currentChartCurrency} å° TWD å¹³å‡åŒ¯ç‡ç‚ºï¼š${randomRate.toFixed(4)}`);
    }

    // --- å•Ÿå‹• ---
    window.onload = function() {
        initDashboard(); 
        initChart();
        setInterval(simulateLiveRates, 1000); 
        simulateLiveRates();
    };

</script>

</body>
</html>
